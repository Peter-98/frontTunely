"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4251],{4251:(D,g,s)=>{s.r(g),s.d(g,{AddSongPageModule:()=>T});var m=s(6895),o=s(433),r=s(2078),u=s(4262),c=s(655),t=s(4650),f=s(9646),h=s(6388),p=s(1481),v=s(7042),A=s(7556),Z=s(7098);function S(e,d){1&e&&(t.TgZ(0,"div"),t._uU(1," Release date should be in yyyy-mm-dd format "),t.qZA())}function b(e,d){1&e&&(t.TgZ(0,"div"),t._uU(1," Duration should be a number "),t.qZA())}function y(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"ion-img",20),t.NdJ("ionError",function(){t.CHM(i);const n=t.oxw(2);return t.KtG(n.onImgError())}),t.qZA()}if(2&e){const i=t.oxw(2);t.Q6J("src",i.photo)("hidden",!i.photo)}}function x(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"form",3),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.onSubmit(n.formValidation.value))}),t.TgZ(2,"ion-item")(3,"ion-label",4),t._uU(4,"Title:"),t.qZA(),t._UZ(5,"ion-input",5),t.qZA(),t.TgZ(6,"ion-item")(7,"ion-label",4),t._uU(8,"Artists: "),t.qZA(),t._UZ(9,"ion-input",6),t.qZA(),t.TgZ(10,"ion-item")(11,"ion-label",4),t._uU(12,"Album: "),t.qZA(),t._UZ(13,"ion-input",7),t.qZA(),t.TgZ(14,"ion-item")(15,"ion-label",4),t._uU(16,"Release Date: "),t.qZA(),t._UZ(17,"ion-input",8),t.YNc(18,S,2,0,"div",2),t.qZA(),t.TgZ(19,"ion-item")(20,"ion-label",4),t._uU(21,"Duration: "),t.qZA(),t._UZ(22,"ion-input",9),t.YNc(23,b,2,0,"div",2),t.qZA(),t.TgZ(24,"ion-item")(25,"ion-label",4),t._uU(26,"Spotify URI: "),t.qZA(),t._UZ(27,"ion-input",10),t.qZA(),t.TgZ(28,"ion-item")(29,"ion-label",4),t._uU(30,"Image URL: "),t.qZA(),t._UZ(31,"ion-input",11),t.TgZ(32,"div",12)(33,"ion-fab-button",13),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.takePicture())}),t._UZ(34,"ion-icon",14),t.qZA()(),t.YNc(35,y,1,2,"ion-img",15),t.qZA(),t._UZ(36,"img",16),t.TgZ(37,"ion-fab",17)(38,"div",18)(39,"ion-button",19),t._uU(40,"Save Song"),t.qZA()()()()()}if(2&e){const i=t.oxw();t.xp6(1),t.Q6J("formGroup",i.formValidation),t.xp6(17),t.Q6J("ngIf",i.showReleaseDateError),t.xp6(5),t.Q6J("ngIf",i.showDurationError),t.xp6(12),t.Q6J("ngIf",!i.photo),t.xp6(1),t.Q6J("src",i.photo,t.LSH),t.xp6(3),t.Q6J("disabled",!i.isFormValid())}}const I=[{path:"",component:(()=>{class e{constructor(i,a,n,l,U,_,C,N){this.sanitizer=i,this.geolocationService=a,this.router=n,this.alertController=l,this.formBuilder=U,this.authService=_,this.activatedRoute=C,this.tracksService=N,this.information=null,this.auth=!1,this.userId="",this.latitude=void 0,this.longitude=void 0,this.accuracy=void 0,this.showReleaseDateError=!1,this.showDurationError=!1,this.photo=null,this.image=null}ngOnInit(){this.resetFields();let i=(this.activatedRoute.snapshot.paramMap.get("id")||"").toString();this.tracksService.getDetails(i).subscribe(a=>{this.information=a,this.takePosition(),this.authService.isAuthenticated().subscribe(n=>{n?(this.userId=n.uid,this.auth=!0):this.auth=!1})})}resetFields(){if(this.formValidation=this.formBuilder.group({name:new o.NI("",o.kI.required),artist:new o.NI("",o.kI.required),album:new o.NI("",o.kI.required),releaseDate:new o.NI("",[o.kI.required,o.kI.pattern(/^\d{4}-\d{2}-\d{2}$/)]),duration:new o.NI("",[o.kI.required,o.kI.pattern(/^-?\d*\.?\d+$/)]),uri:new o.NI("",o.kI.required),image:new o.NI("")}),this.formValidation){const i=this.formValidation.get("releaseDate");i&&i.valueChanges.subscribe(()=>{this.showReleaseDateError=i.invalid});const a=this.formValidation.get("duration");a&&a.valueChanges.subscribe(()=>{this.showDurationError=a.invalid})}}isFormValid(){return void 0!==this.formValidation&&this.formValidation.valid&&(this.formValidation.value.image||this.photo)}takePicture(){return(0,c.mG)(this,void 0,void 0,function*(){const i=yield h.V1.getPhoto({quality:100,allowEditing:!1,resultType:h.dk.Base64});i&&i.base64String&&(this.photo=this.sanitizer.sanitize(t.q3G.RESOURCE_URL,this.sanitizer.bypassSecurityTrustResourceUrl(`data:${"png"===i.format?"image/png":"image/jpeg"};base64,${i.base64String}`)))})}onImgError(){}onSubmit(i){let a={name:i.name,artist:i.artist,album:i.album,releaseDate:i.releaseDate,genres:"",duration:i.duration,uri:i.uri,userId:this.userId,image:i.image,coords:{type:"Point",coordinates:[this.longitude,this.latitude,this.accuracy]},href:this.photo};console.log("foto al guardar",this.photo);const n=(0,f.of)([a]);console.log("datos de salida: ",this.information._id,n),this.tracksService.sendResults(n).subscribe(l=>{console.log("response:",l),"OK"===l?(this.presentAlert("Songs Saved Successfully","Coordinates: Latitude="+this.latitude+", Longitude="+this.longitude+", Accuracy="+this.accuracy),this.router.navigate(["/trackslist"])):"Duplicate Song"===l?this.presentAlert("Duplicate song","Nothing has been saved"):this.presentAlert("Error saving songs","Try again later")})}takePosition(){return(0,c.mG)(this,void 0,void 0,function*(){console.log("Pido ubicacion"),this.geolocationService.getPosition().then(i=>{console.log("Positions: ",i),this.latitude=i.coords.latitude,this.longitude=i.coords.longitude,this.accuracy=i.coords.accuracy}).catch(i=>console.error(i))})}presentAlert(i,a){return(0,c.mG)(this,void 0,void 0,function*(){console.log(i);const n=yield this.alertController.create({header:i,message:a,buttons:["OK"]});yield n.present(),yield n.onDidDismiss().then(()=>{this.router.navigate(["/trackslist"]).then(()=>{location.reload()})})})}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(p.H7),t.Y36(v._),t.Y36(u.F0),t.Y36(r.Br),t.Y36(o.qu),t.Y36(A.e),t.Y36(u.gz),t.Y36(Z.X))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-song"]],decls:8,vars:1,consts:[["slot","start"],["defaultHref","trackslist"],[4,"ngIf"],[1,"form",3,"formGroup","ngSubmit"],["position","floating","color","primary"],["type","text","formControlName","name"],["type","text","formControlName","artist"],["type","text","formControlName","album"],["type","text","formControlName","releaseDate"],["type","text","formControlName","duration"],["type","text","formControlName","uri"],["type","text","formControlName","image"],["slot","end",1,"item-end"],[3,"click"],["name","camera"],[3,"src","hidden","ionError",4,"ngIf"],["alt","",3,"src"],["vertical","bottom","horizontal","center","slot","fixed"],[1,"div-button-create"],["type","submit",3,"disabled"],[3,"src","hidden","ionError"]],template:function(i,a){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Upload song"),t.qZA()()(),t.TgZ(6,"ion-content"),t.YNc(7,x,41,6,"div",2),t.qZA()),2&i&&(t.xp6(7),t.Q6J("ngIf",a.formValidation))},dependencies:[m.O5,o._Y,o.JJ,o.JL,r.oU,r.YG,r.Sm,r.W2,r.IJ,r.W4,r.Gu,r.gu,r.Xz,r.pK,r.Ie,r.Q$,r.wd,r.sr,r.j9,r.cs,o.sg,o.u],styles:["ion-img[_ngcontent-%COMP%]{height:300px;margin-top:16px;margin-bottom:16px}img[_ngcontent-%COMP%]{height:200px;margin-left:16px;margin-top:16px;margin-bottom:16px;object-fit:contain;display:flex;align-items:center;justify-content:center}"]}),e})()}];let P=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[u.Bz.forChild(I),u.Bz]}),e})(),T=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[m.ez,o.u5,r.Pc,P,o.UX]}),e})()}}]);