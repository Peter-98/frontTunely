"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4987],{4987:(M,m,a)=>{a.r(m),a.d(m,{LoginPageModule:()=>g});var d=a(6895),s=a(433),l=a(2078),u=a(4262),t=a(4650),p=a(7556);function f(n,r){if(1&n&&(t.TgZ(0,"div",12),t._uU(1),t.qZA()),2&n){const o=t.oxw().$implicit;t.xp6(1),t.hij(" ",o.message," ")}}function h(n,r){if(1&n&&(t.ynx(0),t.YNc(1,f,2,1,"div",13),t.BQk()),2&n){const o=r.$implicit,i=t.oxw(2);let e;t.xp6(1),t.Q6J("ngIf",(null==i.formValidation||null==(e=i.formValidation.get("email"))?null:e.hasError(o.type))&&((null==(e=i.formValidation.get("email"))?null:e.dirty)||(null==(e=i.formValidation.get("email"))?null:e.touched)))}}function v(n,r){if(1&n&&(t.TgZ(0,"div",12),t._uU(1),t.qZA()),2&n){const o=t.oxw().$implicit;t.xp6(1),t.hij(" ",o.message," ")}}function c(n,r){if(1&n&&(t.ynx(0),t.YNc(1,v,2,1,"div",13),t.BQk()),2&n){const o=r.$implicit,i=t.oxw(2);let e;t.xp6(1),t.Q6J("ngIf",(null==(e=i.formValidation.get("password"))?null:e.hasError(o.type))&&((null==(e=i.formValidation.get("password"))?null:e.dirty)||(null==(e=i.formValidation.get("password"))?null:e.touched)))}}function _(n,r){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"form",3),t.NdJ("ngSubmit",function(){t.CHM(o);const e=t.oxw();return t.KtG(e.tryLogin(e.formValidation.value))}),t.TgZ(2,"ion-item")(3,"ion-label",4),t._uU(4,"Enter your data to access the application:"),t.qZA()(),t.TgZ(5,"ion-item")(6,"ion-label",5),t._uU(7,"Email: "),t.qZA(),t._UZ(8,"ion-input",6),t.qZA(),t.TgZ(9,"div"),t.YNc(10,h,2,1,"ng-container",7),t.qZA(),t.TgZ(11,"ion-item")(12,"ion-label",5),t._uU(13,"Password: "),t.qZA(),t._UZ(14,"ion-input",8),t.qZA(),t.TgZ(15,"div"),t.YNc(16,c,2,1,"ng-container",7),t.qZA(),t.TgZ(17,"div",9)(18,"ion-button",10),t._uU(19,"Login"),t.qZA()(),t.TgZ(20,"div",11)(21,"ion-label",12),t._uU(22),t.qZA()()()()}if(2&n){const o=t.oxw();t.xp6(1),t.Q6J("formGroup",o.formValidation),t.xp6(9),t.Q6J("ngForOf",o.formValidationMessages.email),t.xp6(6),t.Q6J("ngForOf",o.formValidationMessages.password),t.xp6(2),t.Q6J("disabled",!o.formValidation.valid),t.xp6(4),t.Oqu(o.errorMessage)}}const E=[{path:"",component:(()=>{class n{constructor(o,i,e){this.authService=o,this.formBuilder=i,this.router=e,this.errorMessage="",this.formValidationMessages={email:[{type:"required",message:"Email is a required field."},{type:"pattern",message:"The email format is not correct."}],password:[{type:"required",message:"Password is a required field."},{type:"minlength",message:"The minimum length of a password is 6 characters."}]}}ngOnInit(){this.formValidation=this.formBuilder.group({email:new s.NI("",s.kI.compose([s.kI.required,s.kI.pattern("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$")])),password:new s.NI("",s.kI.compose([s.kI.minLength(6),s.kI.required]))})}tryLogin(o){this.authService.doLogin(o).subscribe(i=>{this.router.navigate(["/trackslist"])},i=>{this.errorMessage="auth/user-not-found"===i.code?"Username does not exist.":"auth/wrong-password"===i.code?"Incorrect password.":i.message,console.log(i)})}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(p.e),t.Y36(s.qu),t.Y36(u.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:8,vars:1,consts:[["slot","start"],["defaultHref","trackslist"],[4,"ngIf"],[1,"form",3,"formGroup","ngSubmit"],[1,"label-title"],["position","floating","color","primary"],["type","text","formControlName","email"],[4,"ngFor","ngForOf"],["type","password","formControlName","password"],[1,"div-button-login"],["type","submit",3,"disabled"],[1,"div-label-error"],[1,"error-message"],["class","error-message",4,"ngIf"]],template:function(o,i){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Login"),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content"),t.YNc(7,_,23,5,"div",2),t.qZA()),2&o&&(t.xp6(7),t.Q6J("ngIf",i.formValidation))},dependencies:[d.sg,d.O5,s._Y,s.JJ,s.JL,l.oU,l.YG,l.Sm,l.W2,l.Gu,l.pK,l.Ie,l.Q$,l.wd,l.sr,l.j9,l.cs,s.sg,s.u],styles:[".form[_ngcontent-%COMP%]{margin-top:50px}.label-title[_ngcontent-%COMP%]{font-weight:500;margin-bottom:20px}.div-button-login[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.div-label-error[_ngcontent-%COMP%]{text-align:center;margin-top:10px}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:smaller;padding:10px}"]}),n})()}];let P=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.Bz.forChild(E),u.Bz]}),n})(),g=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,s.u5,l.Pc,s.UX,P]}),n})()},7556:(M,m,a)=>{a.d(m,{e:()=>P});var d=a(655),s=a(4004),l=a(262),u=a(5577),t=a(8996),p=a(9751),f=a(5698),h=a(9260),c=(a(3042),a(4650)),_=a(1762),L=a(1205),E=a(529);let P=(()=>{class g{constructor(r,o,i){this.afs=r,this.afAuth=o,this.http=i,this.url="http://webapps.pedromrtaguilera.tech:3000/auth",this.afAuth.authState.subscribe(e=>{e?(this.userData=e,localStorage.setItem("user",JSON.stringify(this.userData)),JSON.parse(localStorage.getItem("user")||"{}")):(localStorage.setItem("user","{}"),JSON.parse(localStorage.getItem("user")||"{}"))})}postLogin(r,o){const i={email:r,pass:o};return console.log("LOG 1",i),this.http.post(`${this.url}/login`,i).pipe((0,s.U)(e=>{if(e&&e.token)return console.log("LOG 2",e),localStorage.setItem("token",e.token),e.token;throw console.log("LOG 3",e),new Error("Error en la solicitud")}),(0,l.K)(e=>{throw console.log("LOG 4"),new Error("Error en la solicitud")}))}postSignUp(r,o){return this.http.post(`${this.url}/signup`,{email:r,pass:o}).pipe((0,s.U)(e=>{if(e&&e.token)return localStorage.setItem("token",e.token),e.token;throw new Error("Error en la solicitud")}),(0,l.K)(e=>{throw new Error("Error en la solicitud")}))}doLogin(r){const{email:o,password:i}=r;return this.postLogin(o,i).pipe((0,u.z)(e=>(0,t.D)(h.Z.auth().signInWithEmailAndPassword(o,i)).pipe((0,u.z)(O=>(0,t.D)(Promise.resolve(e))),(0,l.K)(O=>{throw new Error("Error en la autenticaci\xf3n de Firebase")}))),(0,l.K)(e=>{throw new Error("Error en la autenticaci\xf3n de MongoDB")}))}doLogout(){return new Promise((r,o)=>{this.afAuth.signOut().then(()=>{localStorage.removeItem("user"),r()}).catch(i=>{console.log(i),o()})})}doRegister(r){return new p.y(o=>{this.postSignUp(r.email,r.password).subscribe(i=>{localStorage.setItem("token",i),this.afAuth.createUserWithEmailAndPassword(r.email,r.password).then(e=>{o.next(e),o.complete()}).catch(e=>{o.error(e)})},i=>{o.error(i)})})}isAuthenticated(){return this.afAuth.authState}getUserId(){return(0,d.mG)(this,void 0,void 0,function*(){const r=yield this.afAuth.authState.pipe((0,f.q)(1)).toPromise();return console.log("respues getId",r),r?r.uid:null})}}return g.\u0275fac=function(r){return new(r||g)(c.LFG(_.ST),c.LFG(L.zQ),c.LFG(E.eN))},g.\u0275prov=c.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);