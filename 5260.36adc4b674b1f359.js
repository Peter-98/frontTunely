"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5260],{5260:(D,g,s)=>{s.r(g),s.d(g,{EditPageModule:()=>S});var h=s(6895),o=s(433),a=s(2078),c=s(4262),m=s(655),t=s(4650),p=s(9646),f=s(6388),v=s(1481),Z=s(7042),b=s(7556),y=s(7098);function E(e,l){1&e&&(t.TgZ(0,"div"),t._uU(1," Release date should be in yyyy-mm-dd format "),t.qZA())}function x(e,l){1&e&&(t.TgZ(0,"div"),t._uU(1," Duration should be a number "),t.qZA())}function I(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"ion-img",20),t.NdJ("ionError",function(){t.CHM(i);const n=t.oxw(2);return t.KtG(n.onImgError())}),t.qZA()}if(2&e){const i=t.oxw(2);t.Q6J("src",i.photo)("hidden",!i.photo)}}function A(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"form",3),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.onSubmit(n.formValidation.value))}),t.TgZ(2,"ion-item")(3,"ion-label",4),t._uU(4,"Title:"),t.qZA(),t._UZ(5,"ion-input",5),t.qZA(),t.TgZ(6,"ion-item")(7,"ion-label",4),t._uU(8,"Artists: "),t.qZA(),t._UZ(9,"ion-input",6),t.qZA(),t.TgZ(10,"ion-item")(11,"ion-label",4),t._uU(12,"Album: "),t.qZA(),t._UZ(13,"ion-input",7),t.qZA(),t.TgZ(14,"ion-item")(15,"ion-label",4),t._uU(16,"Release Date: "),t.qZA(),t._UZ(17,"ion-input",8),t.YNc(18,E,2,0,"div",2),t.qZA(),t.TgZ(19,"ion-item")(20,"ion-label",4),t._uU(21,"Duration: "),t.qZA(),t._UZ(22,"ion-input",9),t.YNc(23,x,2,0,"div",2),t.qZA(),t.TgZ(24,"ion-item")(25,"ion-label",4),t._uU(26,"Spotify URI: "),t.qZA(),t._UZ(27,"ion-input",10),t.qZA(),t.TgZ(28,"ion-item")(29,"ion-label",4),t._uU(30,"Image URL: "),t.qZA(),t._UZ(31,"ion-input",11),t.TgZ(32,"div",12)(33,"ion-fab-button",13),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.takePicture())}),t._UZ(34,"ion-icon",14),t.qZA()(),t.YNc(35,I,1,2,"ion-img",15),t.qZA(),t._UZ(36,"img",16),t.TgZ(37,"ion-fab",17)(38,"div",18)(39,"ion-button",19),t._uU(40,"Save Song"),t.qZA()()()()()}if(2&e){const i=t.oxw();t.xp6(1),t.Q6J("formGroup",i.formValidation),t.xp6(17),t.Q6J("ngIf",i.showReleaseDateError),t.xp6(5),t.Q6J("ngIf",i.showDurationError),t.xp6(12),t.Q6J("ngIf",!i.photo),t.xp6(1),t.Q6J("src",i.photo,t.LSH),t.xp6(3),t.Q6J("disabled",!i.isFormValid())}}const P=[{path:"",component:(()=>{class e{constructor(i,r,n,d,u,U,_,C){this.sanitizer=i,this.geolocationService=r,this.router=n,this.alertController=d,this.formBuilder=u,this.authService=U,this.activatedRoute=_,this.tracksService=C,this.information=null,this.auth=!1,this.userId="",this.latitude=void 0,this.longitude=void 0,this.accuracy=void 0,this.showReleaseDateError=!1,this.showDurationError=!1,this.photo=null,this.image=null}ngOnInit(){let i=(this.activatedRoute.snapshot.paramMap.get("id")||"").toString();this.tracksService.getDetails(i).subscribe(r=>{this.information=r,this.resetFields(r),this.takePosition(),this.authService.isAuthenticated().subscribe(n=>{n?(this.userId=n.uid,this.auth=!0):this.auth=!1})})}resetFields(i){const n=new Date(i.releaseDate).toISOString().slice(0,10);if(this.formValidation=this.formBuilder.group({name:new o.NI(i.name,o.kI.required),artist:new o.NI(i.artist,o.kI.required),album:new o.NI(i.album,o.kI.required),releaseDate:new o.NI(n,[o.kI.required,o.kI.pattern(/^\d{4}-\d{2}-\d{2}$/)]),duration:new o.NI(i.duration,[o.kI.required,o.kI.pattern(/^-?\d*\.?\d+$/)]),uri:new o.NI(i.uri,o.kI.required),image:new o.NI(i.image)}),this.photo=i.href,this.formValidation){const d=this.formValidation.get("releaseDate");d&&d.valueChanges.subscribe(()=>{this.showReleaseDateError=d.invalid});const u=this.formValidation.get("duration");u&&u.valueChanges.subscribe(()=>{this.showDurationError=u.invalid})}}isFormValid(){return void 0!==this.formValidation&&this.formValidation.valid&&(this.formValidation.value.image||this.photo)}takePicture(){return(0,m.mG)(this,void 0,void 0,function*(){const i=yield f.V1.getPhoto({quality:100,allowEditing:!1,resultType:f.dk.Base64});i&&i.base64String&&(this.photo=this.sanitizer.sanitize(t.q3G.RESOURCE_URL,this.sanitizer.bypassSecurityTrustResourceUrl(`data:${"png"===i.format?"image/png":"image/jpeg"};base64,${i.base64String}`)))})}onImgError(){}onSubmit(i){let r={name:i.name,artist:i.artist,album:i.album,releaseDate:i.releaseDate,genres:"",duration:i.duration,uri:i.uri,userId:this.userId,image:i.image,coords:{type:"Point",coordinates:{longitude:this.longitude,latitude:this.latitude,accuracy:this.accuracy}},href:this.photo};console.log("foto al guardar",this.photo);const n=(0,p.of)([r]);console.log("datos de salida: ",this.information._id,n),this.tracksService.updateTrack(this.information._id,n).subscribe(d=>{console.log("response:",d),"OK"===d?(this.presentAlert("Songs Saved Successfully","Coordinates: Latitude="+this.latitude+", Longitude="+this.longitude+", Accuracy="+this.accuracy),this.router.navigate(["/trackslist"])):"Duplicate Song"===d?this.presentAlert("Duplicate song","Nothing has been saved"):this.presentAlert("Error saving songs","Try again later")})}takePosition(){return(0,m.mG)(this,void 0,void 0,function*(){console.log("Pido ubicacion"),this.geolocationService.getPosition().then(i=>{console.log("Positions: ",i),this.latitude=i.coords.latitude,this.longitude=i.coords.longitude,this.accuracy=i.coords.accuracy}).catch(i=>console.error(i))})}presentAlert(i,r){return(0,m.mG)(this,void 0,void 0,function*(){console.log(i);const n=yield this.alertController.create({header:i,message:r,buttons:["OK"]});yield n.present(),yield n.onDidDismiss().then(()=>{this.router.navigate(["/trackslist"]).then(()=>{location.reload()})})})}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(v.H7),t.Y36(Z._),t.Y36(c.F0),t.Y36(a.Br),t.Y36(o.qu),t.Y36(b.e),t.Y36(c.gz),t.Y36(y.X))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-edit"]],decls:8,vars:1,consts:[["slot","start"],["defaultHref","details/information._id"],[4,"ngIf"],[1,"form",3,"formGroup","ngSubmit"],["position","floating","color","primary"],["type","text","formControlName","name"],["type","text","formControlName","artist"],["type","text","formControlName","album"],["type","text","formControlName","releaseDate"],["type","text","formControlName","duration"],["type","text","formControlName","uri"],["type","text","formControlName","image"],["slot","end",1,"item-end"],[3,"click"],["name","camera"],[3,"src","hidden","ionError",4,"ngIf"],["alt","",3,"src"],["vertical","bottom","horizontal","center","slot","fixed"],[1,"div-button-create"],["type","submit",3,"disabled"],[3,"src","hidden","ionError"]],template:function(i,r){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Edit song"),t.qZA()()(),t.TgZ(6,"ion-content"),t.YNc(7,A,41,6,"div",2),t.qZA()),2&i&&(t.xp6(7),t.Q6J("ngIf",r.formValidation))},dependencies:[h.O5,o._Y,o.JJ,o.JL,a.oU,a.YG,a.Sm,a.W2,a.IJ,a.W4,a.Gu,a.gu,a.Xz,a.pK,a.Ie,a.Q$,a.wd,a.sr,a.j9,a.cs,o.sg,o.u],styles:["ion-img[_ngcontent-%COMP%]{height:300px;margin-top:16px;margin-bottom:16px}img[_ngcontent-%COMP%]{height:200px;margin-left:16px;margin-top:16px;margin-bottom:16px;object-fit:contain;display:flex;align-items:center;justify-content:center}"]}),e})()}];let T=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[c.Bz.forChild(P),c.Bz]}),e})(),S=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[h.ez,o.u5,a.Pc,T,o.UX]}),e})()}}]);